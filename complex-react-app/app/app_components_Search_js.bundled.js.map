{"version":3,"sources":["webpack://complex-react-app/./app/components/Search.js"],"names":["Search","appDispatch","useContext","DispatchContext","state","setState","useImmer","searchTerm","results","show","requestCount","useEffect","document","addEventListener","searchKeyPressHandler","removeEventListener","trim","draft","delay","setTimeout","clearTimeout","ourRequest","Axios","fetchResults","response","cancelToken","token","data","e","console","log","cancel","keyCode","type","handleInput","value","target","Boolean","length","map","post","_id"],"mappings":"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","file":"app_components_Search_js.bundled.js","sourcesContent":["import React, { useEffect, useContext } from \"react\"\r\nimport DispatchContext from \"../DispatchContext\"\r\nimport { useImmer } from \"use-immer\"\r\nimport Axios from \"axios\"\r\nimport { Link } from \"react-router-dom\"\r\nimport Post from \"./Post\"\r\n\r\nfunction Search() {\r\n  const appDispatch = useContext(DispatchContext)\r\n\r\n  const [state, setState] = useImmer({\r\n    searchTerm: \"\",\r\n    results: [],\r\n    show: \"neither\",\r\n    requestCount: 0,\r\n  })\r\n\r\n  useEffect(() => {\r\n    document.addEventListener(\"keyup\", searchKeyPressHandler)\r\n    return () => document.removeEventListener(\"keyup\", searchKeyPressHandler)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (state.searchTerm.trim()) {\r\n      setState((draft) => {\r\n        draft.show = \"loading\"\r\n      })\r\n      const delay = setTimeout(() => {\r\n        setState((draft) => {\r\n          draft.requestCount++\r\n        })\r\n      }, 750)\r\n      //cleanup function to clear timeout\r\n      return () => clearTimeout(delay)\r\n    } else {\r\n      setState((draft) => {\r\n        draft.show = \"neither\"\r\n      })\r\n    }\r\n  }, [state.searchTerm])\r\n\r\n  //useEffect takes array for what it monitors\r\n  useEffect(() => {\r\n    if (state.requestCount) {\r\n      const ourRequest = Axios.CancelToken.source()\r\n      async function fetchResults() {\r\n        try {\r\n          const response = await Axios.post(\"/search\", { searchTerm: state.searchTerm }, { cancelToken: ourRequest.token })\r\n          setState((draft) => {\r\n            draft.results = response.data\r\n            draft.show = \"results\"\r\n          })\r\n        } catch (e) {\r\n          console.log(\"There was a problem or the request was cancelled.\")\r\n        }\r\n      }\r\n      fetchResults()\r\n      return () => ourRequest.cancel()\r\n    }\r\n  }, [state.requestCount])\r\n\r\n  function searchKeyPressHandler(e) {\r\n    if (e.keyCode == 27) {\r\n      appDispatch({ type: \"closeSearch\" })\r\n    }\r\n  }\r\n\r\n  function handleInput(e) {\r\n    const value = e.target.value\r\n    setState((draft) => {\r\n      draft.searchTerm = value\r\n    })\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"search-overlay-top shadow-sm\">\r\n        <div className=\"container container--narrow\">\r\n          <label htmlFor=\"live-search-field\" className=\"search-overlay-icon\">\r\n            <i className=\"fas fa-search\"></i>\r\n          </label>\r\n          <input onChange={handleInput} autoFocus type=\"text\" autoComplete=\"off\" id=\"live-search-field\" className=\"live-search-field\" placeholder=\"What are you interested in?\" />\r\n          <span onClick={() => appDispatch({ type: \"closeSearch\" })} className=\"close-live-search\">\r\n            <i className=\"fas fa-times-circle\"></i>\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"search-overlay-bottom\">\r\n        <div className=\"container container--narrow py-3\">\r\n          <div className={\"circle-loader \" + (state.show == \"loading\" ? \"circle-loader--visible\" : \"\")}></div>\r\n          <div className={\"live-search-results \" + (state.show == \"results\" ? \"live-search-results--visible\" : \"\")}>\r\n            {Boolean(state.results.length) && (\r\n              <div className=\"list-group shadow-sm\">\r\n                <div className=\"list-group-item active\">\r\n                  <strong>Search Results</strong> ({state.results.length} {state.results.length > 1 ? \"items\" : \"item\"} found)\r\n                </div>\r\n                {state.results.map((post) => {\r\n                  return <Post post={post} key={post._id} onClick={() => appDispatch({ type: \"closeSearch\" })} />\r\n                })}\r\n              </div>\r\n            )}\r\n            {!Boolean(state.results.length) && <p className=\"alert alert-danger text-center shadow-sm\">Sorry, we could not find any results for that search.</p>}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Search\r\n"],"sourceRoot":""}