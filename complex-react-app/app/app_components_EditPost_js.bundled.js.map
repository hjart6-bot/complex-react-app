{"version":3,"sources":["webpack://complex-react-app/./app/components/EditPost.js","webpack://complex-react-app/./app/components/NotFound.js"],"names":["EditPost","props","appState","useContext","StateContext","appDispatch","DispatchContext","originalState","title","value","hasErrors","message","body","isFetching","isSaving","id","useParams","sendCount","notFound","ourReducer","draft","action","type","trim","state","dispatch","useImmerReducer","submitHandler","e","preventDefault","useEffect","ourRequest","Axios","fetchPost","response","cancelToken","token","data","user","username","author","history","push","console","log","cancel","target","withRouter","NotFound"],"mappings":"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","file":"app_components_EditPost_js.bundled.js","sourcesContent":["import React, { useEffect, useState, useContext } from \"react\"\r\nimport { useImmerReducer } from \"use-immer\"\r\nimport Page from \"./Page\"\r\nimport { useParams, Link, withRouter } from \"react-router-dom\"\r\nimport Axios from \"axios\"\r\nimport LoadingDotsIcon from \"./LoadingDotsIcon\"\r\nimport StateContext from \"../StateContext\"\r\nimport DispatchContext from \"../DispatchContext\"\r\nimport NotFound from \"./NotFound\"\r\n\r\nfunction EditPost(props) {\r\n  const appState = useContext(StateContext)\r\n  const appDispatch = useContext(DispatchContext)\r\n\r\n  const originalState = {\r\n    title: {\r\n      value: \"\",\r\n      hasErrors: false,\r\n      message: \"\",\r\n    },\r\n    body: {\r\n      value: \"\",\r\n      hasErrors: false,\r\n      message: \"\",\r\n    },\r\n    isFetching: true,\r\n    isSaving: false,\r\n    id: useParams().id,\r\n    sendCount: 0,\r\n    notFound: false,\r\n  }\r\n\r\n  function ourReducer(draft, action) {\r\n    switch (action.type) {\r\n      case \"fetchComplete\":\r\n        draft.title.value = action.value.title\r\n        draft.body.value = action.value.body\r\n        draft.isFetching = false\r\n        return\r\n      case \"titleChange\":\r\n        draft.title.hasErrors = false\r\n        draft.title.value = action.value\r\n        return\r\n      case \"bodyChange\":\r\n        draft.body.hasErrors = false\r\n        draft.body.value = action.value\r\n        return\r\n      case \"submitRequest\":\r\n        if (!draft.title.hasErrors && !draft.body.hasErrors) {\r\n          draft.sendCount++\r\n        }\r\n        return\r\n      case \"saveRequestStarted\":\r\n        draft.isSaving = true\r\n        return\r\n      case \"saveRequestFinished\":\r\n        draft.isSaving = false\r\n        return\r\n      case \"titleRules\":\r\n        if (!action.value.trim()) {\r\n          draft.title.hasErrors = true\r\n          draft.title.message = \"You must provide a title.\"\r\n        }\r\n        return\r\n      case \"bodyRules\":\r\n        if (!action.value.trim()) {\r\n          draft.body.hasErrors = true\r\n          draft.body.message = \"You must provide body content.\"\r\n        }\r\n        return\r\n      case \"notFound\":\r\n        draft.notFound = true\r\n        return\r\n    }\r\n  }\r\n\r\n  const [state, dispatch] = useImmerReducer(ourReducer, originalState)\r\n\r\n  function submitHandler(e) {\r\n    e.preventDefault()\r\n    dispatch({ type: \"titleRules\", value: state.title.value })\r\n    dispatch({ type: \"bodyRules\", value: state.body.value })\r\n    dispatch({ type: \"submitRequest\" })\r\n  }\r\n\r\n  useEffect(() => {\r\n    const ourRequest = Axios.CancelToken.source()\r\n    async function fetchPost() {\r\n      try {\r\n        const response = await Axios.get(`/post/${state.id}`, { cancelToken: ourRequest.token })\r\n        if (response.data) {\r\n          dispatch({ type: \"fetchComplete\", value: response.data })\r\n          if (appState.user.username != response.data.author.username) {\r\n            appDispatch({ type: \"flashMessage\", value: \"You do not have permission to edit that post.\" })\r\n            //redirect to homepage\r\n            props.history.push(\"/\")\r\n          }\r\n        } else {\r\n          dispatch({ type: \"notFound\" })\r\n        }\r\n      } catch (e) {\r\n        console.log(\"There was a problem or the request was cancelled.\")\r\n      }\r\n    }\r\n    fetchPost()\r\n    return () => {\r\n      ourRequest.cancel()\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (state.sendCount) {\r\n      dispatch({ type: \"saveRequestStarted\" })\r\n      const ourRequest = Axios.CancelToken.source()\r\n      async function fetchPost() {\r\n        try {\r\n          const response = await Axios.post(`/post/${state.id}/edit`, { title: state.title.value, body: state.body.value, token: appState.user.token }, { cancelToken: ourRequest.token })\r\n          dispatch({ type: \"saveRequestFinished\" })\r\n          appDispatch({ type: \"flashMessage\", value: \"Post was updated.\" })\r\n        } catch (e) {\r\n          console.log(\"There was a problem or the request was cancelled.\")\r\n        }\r\n      }\r\n      fetchPost()\r\n      return () => {\r\n        ourRequest.cancel()\r\n      }\r\n    }\r\n  }, [state.sendCount])\r\n\r\n  if (state.notFound) {\r\n    return <NotFound />\r\n  }\r\n\r\n  if (state.isFetching)\r\n    return (\r\n      <Page title=\"loading...\">\r\n        <LoadingDotsIcon />\r\n      </Page>\r\n    )\r\n\r\n  return (\r\n    <Page title=\"Edit Post\">\r\n      <Link className=\"small font-weight-bold\" to={`/post/${state.id}`}>\r\n        &laquo; Back to post permalink\r\n      </Link>\r\n\r\n      <form className=\"mt-3\" onSubmit={submitHandler}>\r\n        <div className=\"form-group\">\r\n          <label htmlFor=\"post-title\" className=\"text-muted mb-1\">\r\n            <small>Title</small>\r\n          </label>\r\n          <input onBlur={(e) => dispatch({ type: \"titleRules\", value: e.target.value })} onChange={(e) => dispatch({ type: \"titleChange\", value: e.target.value })} value={state.title.value} autoFocus name=\"title\" id=\"post-title\" className=\"form-control form-control-lg form-control-title\" type=\"text\" placeholder=\"\" autoComplete=\"off\" />\r\n          {state.title.hasErrors && <div className=\"alert alert-danger small liveValidateMessage\">{state.title.message}</div>}\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label htmlFor=\"post-body\" className=\"text-muted mb-1 d-block\">\r\n            <small>Body Content</small>\r\n          </label>\r\n          <textarea onBlur={(e) => dispatch({ type: \"bodyRules\", value: e.target.value })} onChange={(e) => dispatch({ type: \"bodyChange\", value: e.target.value })} name=\"body\" id=\"post-body\" className=\"body-content tall-textarea form-control\" type=\"text\" value={state.body.value} />\r\n          {state.body.hasErrors && <div className=\"alert alert-danger small liveValidateMessage\">{state.body.message}</div>}\r\n        </div>\r\n\r\n        <button className=\"btn btn-primary\" disabled={state.isSaving}>\r\n          {state.isSaving ? \"Saving...\" : \"Save Updates\"}\r\n        </button>\r\n      </form>\r\n    </Page>\r\n  )\r\n}\r\n\r\nexport default withRouter(EditPost)\r\n","import React from \"react\"\r\nimport Page from \"./Page\"\r\nimport { Link } from \"react-router-dom\"\r\n\r\nfunction NotFound() {\r\n  return (\r\n    <Page title=\"Not Found\">\r\n      <div className=\"text-center\">\r\n        <h2>Whoops, we cannot find that page.</h2>\r\n        <p className=\"lead text-muted\">\r\n          You can always visit the <Link to=\"/\">homepage</Link> to get a fresh start.\r\n        </p>\r\n      </div>\r\n    </Page>\r\n  )\r\n}\r\n\r\nexport default NotFound\r\n"],"sourceRoot":""}